<!DOCTYPE html>
<html>
<head>
    <title>Warden Dashboard - SmartHostel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css?v=1">
</head>
<body>
    <div class="container mt-5">
        <h2>Warden Dashboard</h2>
        <ul class="nav nav-tabs mb-3">
            <li class="nav-item">
                <a class="nav-link active" id="serviceTab" data-bs-toggle="tab" href="#serviceRequests">Service Requests {% if counters %}<span class="badge bg-secondary">{{ counters.service }}</span>{% endif %}</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="outingTab" data-bs-toggle="tab" href="#outingRequests">Outing Requests {% if counters %}<span class="badge bg-secondary">{{ counters.outing }}</span>{% endif %}</a>
            </li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="serviceRequests">
                <ul id="serviceRequestsList" class="list-group">
                    {% for request in requests %}
                    {% if request[1] == 'service' %}
                    <li class="list-group-item">
                        Request #{{ request[0] }}: Room {{ request[2] }} - {{ request[3] }} [Status: {{ request[4] }}]
                        {% if request[4] == 'pending' %}
                        <button class="approveBtn btn btn-success btn-sm ms-2" data-id="{{ request[0] }}" data-type="service">Approve</button>
                        <button class="rejectBtn btn btn-danger btn-sm ms-2" data-id="{{ request[0] }}" data-type="service">Reject</button>
                        {% endif %}
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
                <h5 class="mt-3">Pending Bookings</h5>
                <ul id="bookingRequestsList" class="list-group">
                    {% for request in requests %}
                    {% if request[1] == 'booking' %}
                    <li class="list-group-item">
                        Booking #{{ request[0] }}: Room {{ request[2] }} (by {{ request[3] }}) [Status: {{ request[4] }}]
                        {% if request[4] == 'pending' %}
                        <button class="approveBtn btn btn-success btn-sm ms-2" data-id="{{ request[0] }}" data-type="booking">Approve</button>
                        <button class="rejectBtn btn btn-danger btn-sm ms-2" data-id="{{ request[0] }}" data-type="booking">Reject</button>
                        {% endif %}
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
            <div class="tab-pane fade" id="outingRequests">
                <ul id="outingRequestsList" class="list-group">
                    {% for request in requests %}
                    {% if request[1] == 'outing' %}
                    <li class="list-group-item">
                        Request #{{ request[0] }}: Resident {{ request[2] }} ({{ request[3] }}) [Status: {{ request[4] }}]
                        {% if request[4] == 'pending' %}
                        <button class="approveBtn btn btn-success btn-sm ms-2" data-id="{{ request[0] }}" data-type="outing">Approve</button>
                        <button class="rejectBtn btn btn-danger btn-sm ms-2" data-id="{{ request[0] }}" data-type="outing">Reject</button>
                        {% endif %}
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
    <h4 class="mt-4">Technician Heatmap</h4>
        <canvas id="heatmap" width="400" height="200"></canvas>
    <div class="small text-muted">Shows number of service requests per room. Green = Low, Yellow = Medium, Red = High. All rooms (101â€“110) are included; rooms with no requests show as zero.</div>
    <h4 class="mt-4">Bookings Heatmap</h4>
    <canvas id="bookingsHeatmap" width="400" height="200"></canvas>
    <div class="small text-muted">Shows approved booking occupancy (sum of roommates) per room. Green = Low, Yellow = Medium, Red = High.</div>
        <h4 class="mt-4">Room Occupancy Tracker</h4>
        <table class="table" id="occupancyTable">
            <thead>
                <tr>
                    <th>Room No</th>
                    <th>Total Beds</th>
                    <th>Occupied</th>
                    <th>Available</th>
                    <th>Residents</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamically populated by JavaScript -->
            </tbody>
        </table>
        <button id="logoutBtn" class="btn btn-danger mt-3">Logout</button>
    </div>
    <script type="application/json" id="heatmap-data">
        {{ heatmap | tojson }}
    </script>
    <script type="application/json" id="bookings-heatmap-data">
        {{ bookings_heatmap | tojson }}
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/script.js?v=6"></script>
</body>
</html>