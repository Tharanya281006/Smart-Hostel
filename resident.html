<!DOCTYPE html>
<html>
<head>
    <title>Resident Dashboard - SmartHostel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css?v=1">
</head>
<body>
    <div class="container mt-5">
        <h2>Resident Dashboard</h2>
        <div class="mb-3">
            <span class="h5">Hi <span id="greetName">{{ profile.display_name if profile else '' }}</span>!</span>
        </div>
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Your Details</h5>
                <div class="row g-2 align-items-end">
                    <div class="col-md-5">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" id="profileName" value="{{ profile.display_name if profile else '' }}" placeholder="Enter your name">
                    </div>
                    <div class="col-md-5">
                        <label class="form-label">Phone (optional)</label>
                        <input type="text" class="form-control" id="profilePhone" value="{{ profile.phone if profile else '' }}" placeholder="Phone number">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-outline-primary w-100" id="saveProfile">Save</button>
                    </div>
                </div>
            </div>
        </div>
    {% if my_room %}
    <div class="alert alert-info">Your room: <strong>{{ my_room }}</strong> <small class="text-muted ms-2">(Note: Room1 = 101)</small></div>
        {% else %}
        <div class="alert alert-warning">No approved room yet.</div>
        {% endif %}
        <div class="mb-3">
            <button id="bookBtn" class="btn btn-success">Create Booking</button>
            <span id="bookingCountdown" class="ms-2"></span>
            <span id="bookingDisabledMsg" class="text-danger ms-2" style="display:none">You already have an approved room; booking disabled.</span>
        </div>
        <div id="bookingStatus"></div>
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <input type="number" id="roommatesCount" class="form-control" min="1" max="4" value="1" placeholder="Roommates count" />
            </div>
            <div class="col-md-4">
                <input type="number" id="roomIdInput" class="form-control" min="101" max="999" value="101" placeholder="Room number" />
            </div>
            <div class="col-md-4">
                <button id="loadAvailability" class="btn btn-outline-primary w-100">Check Availability</button>
            </div>
        </div>
    <div id="availability" class="mb-3"></div>
        <h4>Service Requests</h4>
        <form id="serviceForm" class="mb-3" disabled>
            <select name="issue_type" class="form-control mb-2">
                <option value="1-Electricity">Electricity</option>
                <option value="2-Plumbing">Plumbing</option>
                <option value="3-WiFi">WiFi</option>
            </select>
            <textarea name="description" placeholder="Description (optional)" class="form-control mb-2"></textarea>
            <button type="submit" class="btn btn-primary" formnovalidate>Submit</button>
        </form>
        <div id="featureLockMsg" class="text-muted" style="display:none">Features are locked until your booking is approved.</div>
        <h4>Outing Requests</h4>
        <form id="outingForm" class="mb-3" novalidate disabled>
            <label class="form-label">Check-out (Start time)</label>
            <input type="datetime-local" name="start_time" id="start_time" class="form-control mb-2">
            <label class="form-label">Check-in (End time)</label>
            <input type="datetime-local" name="end_time" id="end_time" class="form-control mb-2">
            <input type="text" name="reason" id="reason" placeholder="Reason" class="form-control mb-2">
            <button type="submit" class="btn btn-primary" formnovalidate>Submit</button>
        </form>
        <h4>My Requests Log</h4>
        <ul id="requestLog">
            {% for r in requests %}
            <li>
                {% if r[0] == 'booking' %}
                Booking #{{ r[1] }} - Room {{ r[3] }} [Status: {{ r[2] }}]
                {% elif r[0] == 'service' %}
                Service #{{ r[1] }} [Status: {{ r[2] }}] {{ r[3] }}
                {% elif r[0] == 'outing' %}
                Outing #{{ r[1] }} [Status: {{ r[2] }}] {{ r[3] }}
                {% else %}
                {{ r[0] }} #{{ r[1] }} [Status: {{ r[2] }}]
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        <div id="notifications"></div>
        <button id="logoutBtn" class="btn btn-danger mt-3">Logout</button>
    </div>
    <script src="/static/js/script.js?v=5"></script>
</body>
</html>